// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// prisma/schema.prisma
enum InspectionStatus {
  PENDING // Default status after creation by Mechanic
  APPROVED // Status after approval by Leader/Admin
  REJECTED // Status if rejected
}

enum EquipmentType {
  track
  wheel
  support
}

// 2. Enum for Track Subtypes (used in the base table for easy filtering)
enum TrackGeneralType {
  BigDigger
  SmallPC
  Bulldozer
}

enum WheelGeneralType {
  DumpTruck
  HeavyDumpTruck // Dari CHECKSHEET DAILY INSPECTION WHEEL_page-0002
  Grader
  Compactor
  // Tambahkan sub-tipe Wheel lainnya di sini
}

// USER MODEL (Updated to link to approved inspections)
model User {
  id                  String       @id @default(auto()) @map("_id") @db.ObjectId
  username            String?
  contact             String?
  email               String       @unique
  password            String
  role                String       @default("mechanic")
  employeeId          String?
  department          String?
  approvedInspections Inspection[] @relation("ApprovedBy")
  createdInspections  Inspection[] @relation("CreatedBy")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// CORE MODEL: Inspection (Holds common data and approval status)
model Inspection {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  // REQUIRED HEADER FIELDS (Non-nullable)
  equipmentId    String
  modelUnit      String
  location       String
  operatorName   String
  mechanicName   String
  inspectionDate String
  inspectionTime String
  workingHours   Int
  smr            Int
  timeDown       String
  timeOut        String
  shift          String

  notes           String?
  groupLeaderName String?

  status InspectionStatus @default(PENDING)

  mechanicId String @db.ObjectId
  mechanic   User   @relation("CreatedBy", fields: [mechanicId], references: [id])

  approverId String? @db.ObjectId
  approver   User?   @relation("ApprovedBy", fields: [approverId], references: [id])

  approvalDate DateTime?

  // TYPE DISCRIMINATOR
  equipmentType        EquipmentType
  equipmentGeneralType TrackGeneralType?
  wheelGeneralType     WheelGeneralType?

  // RELATIONSHIP
  trackDetails TrackInspectionDetails?
  wheelDetails WheelInspectionDetails?
  createdAt    DateTime                @default(now())
  updatedAt    DateTime                @updatedAt
}

// 2. DETAIL MODEL: TrackInspectionDetails (All Subtype Checklist Fields)
model TrackInspectionDetails {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  // RELATIONSHIP
  inspectionId String     @unique @db.ObjectId
  inspection   Inspection @relation(fields: [inspectionId], references: [id])

  // DYNAMIC/UNSTRUCTURED DATA
  findings Json? // Array of { description, status } objects

  // ==========================================================
  // COMMON TRACK CHECKLIST FIELDS (Result Type: "ok" | "failure")
  // ==========================================================
  lowerLockOutSwitch       String?
  lowerTrackLinkTension    String?
  lowerTrackShoeBolt       String?
  lowerIdlerRollerGuard    String?
  lowerUnderGuard          String?
  lowerFinalDriveSprocket  String?
  lowerSwingCircle         String?
  lowerAttachmentCondition String?
  lowerDrainWaterSediment  String?
  lowerHydraulicOilLevel   String?

  upperEngineOilLevel     String?
  upperEngineVisual       String?
  upperCoolantLevel       String?
  upperRadiatorEtc        String? // Used by BigDigger/Schema
  upperRadiator           String? // Used by SmallPC (if different from upperRadiatorEtc)
  upperTurboInlet         String?
  upperAirCleaner         String?
  upperCompartmentLeaks   String?
  upperHydraulicPump      String?
  upperControlValve       String?
  upperSwingMachineOil    String?
  upperElectricWiring     String?
  upperBatteryElectrolyte String?
  upperFanBelts           String?
  upperCylinderLeaks      String?
  upperCoverHandRail      String?

  // Cabin & Safety Checks
  cabinMonitorPanel      String?
  cabinSwitches          String?
  cabinGauge             String?
  cabinControlLever      String?
  cabinRadioComm         String?
  cabinFmRadio           String?
  cabinWorkLamp          String?
  cabinTravelAlarm       String?
  cabinHorn              String?
  cabinMirror            String?
  cabinRotaryLamp        String?
  cabinWiper             String?
  cabinWindowWasher      String?
  cabinAcFunction        String?
  cabinFuseRelay         String?
  cabinOperatorSeat      String?
  safetyFireExtinguisher String?
  safetyEmergencyStop    String?
  safetyCabinRops        String?
  safetyBelt             String?

  // ==========================================================
  // TEMPERATURES (Float)
  // ==========================================================
  deltaTCylBoom   Float? // Perbedaan Suhu Silinder Boom (ΔT)
  deltaTCylArm    Float? // Perbedaan Suhu Silinder Arm (ΔT)
  deltaTCylBucket Float? // Perbedaan Suhu Silinder Bucket (ΔT)
  tempCylBoom     String?
  tempCylBoomRh   Float?
  tempCylBoomLh   Float?
  tempCylArm      String?
  tempCylArmRh    Float?
  tempCylArmLh    Float?
  tempCylBucket   String?
  tempCylBucketRh Float?
  tempCylBucketLh Float?

  // ==========================================================
  // GREASE FIELDS (String as requested, but usually Float/Int)
  // ==========================================================
  greaseBoomCylFoot        String?
  greaseBoomFootPin        String?
  greaseBoomCylRod         String?
  greaseArmCylFoot         String?
  greaseBoomArmCoupling    String?
  greaseArmCylRod          String?
  greaseBucketCylFoot      String?
  greaseArmLinkCoupling    String?
  greaseArmBucketCoupling  String?
  greaseLinkCoupling       String?
  greaseBucketCylRod       String?
  greaseBucketLinkCoupling String?

  // ==========================================================
  // TOP-UP QUANTITIES (Float - should be numerical)
  // ==========================================================
  // Small PC naming
  topUpCoolant        Float?
  topUpEngine         Float?
  topUpHydraulic      Float?
  topUpSwingMachinery Float?
  topUpFinalDrive     Float?

  // Big Digger/Bulldozer naming
  topUpCoolantQty        Float?
  topUpEngineQty         Float?
  topUpHydraulicQty      Float?
  topUpSwingMachineryQty Float?
  topUpFinalDriveQty     Float?
  topUpTransmission      Float?

  // ==========================================================
  // BULLDOZER SPECIFIC FIELDS
  // ==========================================================
  engineOilLevelLeakage     String?
  engineCoolantLevelLeakage String?
  engineFuelSystemLeakage   String?
  engineBelts               String?
  engineIntakeClamps        String?
  engineExhaustLeakage      String?
  engineOperationalSound    String?

  powertrainTransmissionOil    String?
  powertrainTorqueConverterOil String?
  powertrainDifferentialOil    String?
  powertrainFinalDriveOil      String?
  powertrainBrakeOperation     String?
  powertrainPropellerShaft     String?

  hydraulicOilLevel           String?
  hydraulicSystemLeakage      String?
  hydraulicPumpLineLeakage    String?
  hydraulicHoseCondition      String?
  hydraulicCylinderLiftBlade  String?
  hydraulicCylinderTiltBlade  String?
  hydraulicCylinderLiftRipper String?
  hydraulicCylinderTiltRipper String?

  structureAutolube            String?
  structureEqualizerBarSeal    String?
  structurePivotShaftLeakage   String?
  structureFrameCracks         String?
  structureTrackLinkBushing    String?
  structureUndercarriageBolt   String?
  structureTrackTension        String?
  structureRipperFrame         String?
  structureBogglePivot         String?
  structureMasterLinkBolt      String?
  structureIdlerMountingBolt   String?
  structureEqualizerBarBearing String?
  structureBladeMountingPin    String?
  structureCuttingEdge         String?
  structureEndBit              String?
  structureCarrieRoller        String?
  structureRipperPoint         String?

  electricalBatteryMounting    String?
  electricalBatteryElectrolyte String?
  electricalTerminalCleaning   String?
  electricalConnectorCleaning  String?
  electricalLamps              String?
  electricalIsolationSwitch    String?
  electricalGaugePanel         String?
  electricalBackupAlarm        String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// DETAIL MODEL: WheelInspectionDetails (Menggabungkan Dump Truck, Grader, Compactor, Heavy Dump Truck)
model WheelInspectionDetails {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  // RELATIONSHIP
  inspectionId String     @unique @db.ObjectId
  inspection   Inspection @relation(fields: [inspectionId], references: [id])

  // DYNAMIC/UNSTRUCTURED DATA
  findings Json?

  engineFuelSystemLeakage String?
  acBlower                String?
  checkMDVR               String?
  apar                    String?
  coolant                 Float?

  radiatorConnection  String?
  engineUnusualSound  String?
  alternatorCondition String?
  fanGuardCondition   String?
  leftFrontWheel      String?
  hoistCylinder       String?
  leftRearFinalDrive  String?

  starterMotorCondition String?
  acCompressorCondition String?
  turbochargerCondition String?
  waterPumpCondition    String?
  beltTension           String?
  ropsMounting          String?
  steeringLinkage       String?
  frontSuspension       String?
  rearSuspension        String?
  hydraulicTank         String?
  tankMounting          String?
  chassisMainFrame      String?
  leftRearWheel         String?
  dumpBody              String?
  greaseLine            String?
  hydraulicLine         String?
  airCleaner            String?
  steeringOilTank       String?
  greaseSystem          String?
  batteryElectrolyte    String?
  handRail              String?
  walkways              String?

  rightRearWheel      String?
  rhFinalDrive        String?
  rhRearSuspension    String?
  fuelTankMounting    String?
  fuelLineCondition   String?
  rhChassisMounting   String?
  rhFrontSuspension   String?
  rhSteeringLinkage   String?
  rhDumpBodyCondition String?

  rearAxleLooseBolts String?
  rearAxleOilLeaks   String?

  differentialCondition String?
  transmissionCondition String?
  powerTrainLine        String?
  torqueConverter       String?
  driveShaftJoint       String?

  cabinGlass          String?
  cabinRops           String?
  seatSafetyBelt      String?
  wiperFunction       String?
  hornFunction        String?
  radioCommunication  String?
  reverseCamera       String?
  mdvr                String?
  mirrorCondition     String?
  doorLock            String?
  monitoringSystem    String?
  secondarySteering   String?
  allBrakeFunction    String?
  parkingBrakeControl String?
  emergencyStop       String?
  fireExtinguisher    String?

  conditionEngineOil       String?
  conditionHydraulic       String?
  conditionFrontSuspension String?
  conditionRearSuspension  String?
  conditionTransmission    String?
  conditionDifferential    String?
  conditionFinalDrive      String?
  conditionBrakeFluid      String?
  conditionSteering        String?
  conditionGrease          String?
  conditionCoolant         String?

  structureDriveAxleOilLevel        String?
  structurePinSpringSteeringTrunion String?
  structureMountingRubberTorqueRod  String?
  structureSpringUBolt              String?
  structureVStayFrontRear           String?
  structureBallJointTieRod          String?
  structureBallJointDragLink        String?
  structureShockAbsorber            String?
  structureTyreBoltPressure         String?
  structureRubberHollowspring       String?

  electricalBackupAlarm String?

  attachmentDumpBodyVessel     String?
  attachmentSafetyDumpFunction String?
  greaseCentralGrease          String?
  greaseAllPointsArea          String?

  engineVisualCheck      String? // Check engine condition from: leaks, lose bolt & etc
  engineUpperLeaks       String? // Check oil leak, coolant leak dan gas leak at upper engine compartment area
  engineFuelLine         String? // Check all fuel line for tighneass, wear dan leakage
  engineOilLevel         String? // Check engine oil level
  engineMounting         String? // Check engine mounting & fitting parts
  engineCoolantLevel     String? // Check water coolant level & any lekage
  engineBeltTension      String? // Check all -belt tension & related parts
  engineAirIntake        String? // Check air intake & exhaust connection
  engineExhaustLeakage   String? // Check exhaust manifold & muffler leakage
  engineOperationalSound String? // Check engine operational sound and low power
  engineAlternator       String? // Check alternator condition
  engineStarterMotor     String? // Check starter motor condition
  engineAcCompressor     String? // Check AC compressor condition
  engineWaterPump        String? // Check Water Pump condition
  engineTurbocharger     String? // Check Turbocharger condition

  // ==========================================================
  // B. POWER TRAIN (Transmission, Axle, Brakes)
  // ==========================================================
  powertrainTransmissionOilLevel String? // Check transmission oil level
  powertrainClutchFunction       String? // Check Clutch Function & Wear Pad Clutch
  powertrainUniversalJoint       String? // Check Universal Joint & Lubricate
  powertrainDifferentialOil      String? // Check Differential oil level & leakage
  powertrainFinalDriveOil        String? // Check Final Drive oil level & leakage
  powertrainBrakeOperation       String? // Check Brake Function, Brake Pressure & Parking Brake (Grader/HDT)
  powertrainPropellerShaft       String? // Check Propeller Shaft (HDT/Grader)

  // ==========================================================
  // C. HYDRAULIC SYSTEM
  // ==========================================================
  hydraulicOilLevel             String? // Check hydraulic oil level
  hydraulicSystemLeakage        String? // Check hydraulic cylinder & connection condition
  hydraulicPumpLeakage          String? // Check leakage from Pump, Motor, PTO, Hose/ piping connection
  hydraulicControlValveLeakage  String? // Check leaks from control valve
  hydraulicWheelLeanCylinder    String? // Check wheel lean cylinder (Grader)
  hydraulicSteeringCylinder     String? // Check streering cylinder (Grader)
  hydraulicBladeLiftCylinder    String? // Check blade lift cylinder (Grader)
  hydraulicSideShiftCylinder    String? // Check side shift cylinder (Grader)
  hydraulicCenterShiftCylinder  String? // Check center shift cylinder (Grader)
  hydraulicArticulationCylinder String? // Check articulation cylinder (Grader)
  hydraulicHoseCondition        String? // Check All Hydraulic hose condition

  // ==========================================================
  // D. WHEEL / AXLE / STRUCTURE (Compactor, Dump Truck, Grader)
  // ==========================================================
  structureFrontAxleOilLevel    String? // Check oil level in the drive axle/front axle
  structureWheelHubLevel        String? // Check oil level in the wheel hub
  structureReducingGearLevel    String? // Check oil level in the reducing gear
  structureNutWheelTirePressure String? // Check nut wheel & tyre pressure
  structureTireCondition        String? // Check Tire condition (HDT)
  structureDumpBodyPin          String? // Check Dump Body, Pin, Pad, Stabilizer, tail gate & vesel (Dump Truck/HDT)
  structureFrameCracks          String? // Check entire Machine frame, chasis body for cracks (Grader)
  structureRipperAssembly       String? // Check Ripper Assembly (Grader)
  structureTandemHousing        String? // Check LH/RH Tandem housing for leaks (Grader)
  structureWheelSpindle         String? // Check all wheel spindle bearing for leaks (Grader)
  structureCircleDrive          String? // Check circle drive for leaks (Grader)
  structureOscillationArea      String? // Check Oscillation Area (Grader)
  structureDrumReduction        String? // Check oil level in the drum reduction gear (Compactor)
  structureVibrationBearing     String? // Check oil level in vibration bearing (Compactor)
  structureAllGreasingPoints    String?

  // ==========================================================
  // E. CABIN & SAFETY DEVICE (Common)
  // ==========================================================
  cabinCleaning          String? // Cleaning cabin & check panel Function
  cabinLock              String? // Check lock cabin & lock tilt cabin
  cabinSeatBelt          String? // Check Seat & Safety Belt
  cabinControlLever      String? // Check Transmissi & Steering/Travel Control Lever Function
  cabinAttachmentLever   String? // Check Attachment Control Lever
  cabinAcBlower          String? // Check AC / Blower
  cabinMirror            String? // Check mirror condition
  cabinSwitchFunction    String? // Check switch function
  cabinWiper             String? // Check wiper function
  cabinHorn              String? // Check horn function
  cabinLamps             String? // Check all lamp function & Rotary lamp
  cabinBatteryConnection String? // Check Battery & connection condition
  cabinRadioComm         String? // Check Radio Communication
  cabinBrakeFunction     String? // Check all brake function
  cabinEmergencyStop     String? // Check Emergency Stop function
  cabinApar              String? // Check APAR
  cabinReverseCamera     String? // Check Reverse Camera function (HDT/Grader)
  cabinMdvr              String? // Check MDVR (HDT/Grader)
  cabinMonitoringSystem  String? // Check monitoring system condition (HDT/Grader)
  // ==========================================================
  // F. TOP-UP QUANTITIES
  // ==========================================================
  topUpEngine            Float? // SAE 15W-40
  topUpHydraulic         Float? // TURALIK 46
  topUpTransmission      Float? // 85W-140 / TUDH 46, 68
  topUpDifferential      Float? // 85W-140 / HD 30
  topUpFinalDrive        Float? // 85W-140 / HD 30
  topUpWheelMotor        Float? // 85W-140 (Compactor)
  topUpVibrator          Float? // 85W-140 (Compactor)
  topUpCoolant           Float? // AF-NACDM / Coolant
  topUpGrease            Float? // V220
  topUpSteering          Float? // ATF 220

  // GRADER
  engineHydraulicPump      String?
  engineElectricalHarness  String?
  engineBatteryElectrolyte String?
  engineBelts              String?
  engineCoverHandRail      String?
  engineTransmissionLeaks  String?

  coolingRadiator    String?
  coolingFanGuard    String?
  coolingBeltTension String?

  hydraulicRipperCylinder String?

  cabinDoorLock                  String?
  cabinTransmissionSteeringLever String?
  cabinSwitch                    String?
  cabinBattery                   String?
  cabinRadio                     String?
  cabinBrake                     String?
  cabinParkingBrake              String?
  cabinFireExtinguisher          String?

  topUpEngineOil     Float?
  topUpCircle        Float?
  topUpTandem        Float?
  topUpFrontWheelHub Float?
  topUpBreak         Float?

  structureBladeGETCondition       String?
  structureStepLadderCondition     String?
  structureTandemHousingLeaks      String?
  structureCoverGuards             String?
  structureWheelSpindleLeaks       String?
  fuelTankDamageLeaks              String?
  structureCircleDriveLeaks        String?
  structureArticulationCleanliness String?
  hydraulicTankDamageLeaks         String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
